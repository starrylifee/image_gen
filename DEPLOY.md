# 클라우드 타입 배포 가이드

이 문서는 교사 승인 이미지 생성 시스템을 클라우드 타입과 MongoDB Atlas를 이용하여 배포하는 방법을 설명합니다.

## 1. MongoDB Atlas 설정

1. [MongoDB Atlas](https://www.mongodb.com/cloud/atlas/register)에 가입합니다.
2. 무료 티어(M0)로 새 클러스터를 생성합니다.
3. 네트워크 액세스 설정에서 IP 액세스 설정을 `0.0.0.0/0`으로 추가하여 모든 IP에서 접근 가능하게 합니다.
4. 데이터베이스 접근 설정에서 새 사용자를 생성합니다 (사용자 이름과 비밀번호를 기억해 두세요).
5. 클러스터가 생성되면 "Connect" 버튼을 클릭하고 "Connect your application"을 선택합니다.
6. 연결 문자열을 복사합니다:
   ```
   mongodb+srv://<username>:<password>@cluster0.xxxxx.mongodb.net/image-generation-approval?retryWrites=true&w=majority
   ```
7. 복사한 연결 문자열의 `<username>`과 `<password>` 부분을 실제 사용자 정보로 변경합니다.

## 2. 환경 변수 설정

1. `backend/.env.production` 파일을 열고 다음 내용을 수정합니다:
   - `MONGODB_URI`: MongoDB Atlas 연결 문자열로 변경
   - `JWT_SECRET`: 강력한 무작위 문자열로 변경
   - `OPENAI_API_KEY`: 실제 OpenAI API 키로 변경

## 3. 클라우드 타입 배포

1. [클라우드 타입](https://cloudtype.io/)에 가입합니다.
2. 새 프로젝트를 생성합니다.
3. "배포하기" > "소스 연결" 선택:
   - GitHub 계정을 연결하고 이 프로젝트 저장소를 선택합니다.
4. "Docker" 서비스 선택:
   - 루트 디렉토리의 `Dockerfile`을 자동으로 감지합니다.
   - 포트: 8080
5. 환경 변수 설정:
   - 모든 환경 변수는 `backend/.env.production` 파일에 포함되어 있으므로 추가 설정이 필요하지 않습니다.
6. "배포하기" 버튼을 클릭하여 배포를 시작합니다.
7. 배포가 완료되면 제공된 URL로 접속하여 애플리케이션을 확인합니다.

## 4. 데이터베이스 초기 설정

1. 애플리케이션에 접속하여 관리자 계정을 등록합니다.
2. 교사 계정을 생성하고 학생 계정을 생성합니다.
3. 일반적인 사용 방법에 따라 시스템을 사용합니다.

## 문제 해결

### 이미지가 표시되지 않는 경우
- 클라우드 타입의 파일 시스템은 휘발성이므로, 장기간 이미지 저장이 필요하다면 AWS S3 같은 클라우드 스토리지를 연결해야 합니다.

### 소켓 연결 문제
- 로그를 확인하여 소켓 연결 오류를 확인하세요.
- 클라우드 타입의 웹소켓 설정이 올바르게 되어 있는지 확인하세요.

### 데이터베이스 연결 문제
- MongoDB Atlas 연결 문자열이 올바른지 확인하세요.
- IP 접근 제한 설정을 확인하세요. 